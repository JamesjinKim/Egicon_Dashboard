<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EZ-Dash ì‹¬í”Œ ì„¼ì„œ ëŒ€ì‹œë³´ë“œ</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .status {
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 25px;
            display: inline-block;
            color: white;
            margin-bottom: 20px;
        }

        .sensors-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            max-width: 1200px;
            margin: 0 auto;
        }

        .sensor-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .sensor-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
        }

        .sensor-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: var(--sensor-color);
        }

        .sensor-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
        }

        .sensor-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            background: var(--sensor-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 1.5rem;
            margin-right: 15px;
        }

        .sensor-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
        }

        .sensor-value {
            font-size: 3rem;
            font-weight: 700;
            color: var(--sensor-color);
            margin-bottom: 10px;
        }

        .sensor-unit {
            font-size: 1.2rem;
            color: #666;
            font-weight: normal;
        }

        .sensor-info {
            font-size: 0.9rem;
            color: #888;
            border-top: 1px solid #eee;
            padding-top: 15px;
        }

        /* ì„¼ì„œë³„ ìƒ‰ìƒ */
        .temperature {
            --sensor-color: #ff6b6b;
        }

        .humidity {
            --sensor-color: #4ecdc4;
        }

        .light {
            --sensor-color: #ffe66d;
        }

        .pressure {
            --sensor-color: #a8e6cf;
        }

        .vibration {
            --sensor-color: #ff8b94;
        }

        .air-quality {
            --sensor-color: #88d8b0;
        }

        .loading {
            text-align: center;
            color: #666;
            font-style: italic;
        }

        .error {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }

        .footer {
            text-align: center;
            color: rgba(255,255,255,0.8);
            margin-top: 40px;
            font-size: 0.9rem;
        }

        @media (max-width: 768px) {
            .sensors-grid {
                grid-template-columns: 1fr;
                gap: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .sensor-value {
                font-size: 2.5rem;
            }
        }

        /* ì• ë‹ˆë©”ì´ì…˜ */
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.7; }
            100% { opacity: 1; }
        }

        .updating {
            animation: pulse 1s infinite;
        }
    </style>
</head>
<body>
    <div class="header">
        <h1><i class="fas fa-chart-line"></i> EZ-Dash ì„¼ì„œ ëª¨ë‹ˆí„°</h1>
        <div class="status" id="status">
            <i class="fas fa-circle" id="status-icon"></i>
            <span id="status-text">ì—°ê²° ì¤‘...</span>
            <span id="last-update"></span>
        </div>
    </div>

    <div class="sensors-grid" id="sensors-grid">
        <!-- ì˜¨ë„ ì„¼ì„œ -->
        <div class="sensor-card temperature">
            <div class="sensor-header">
                <div class="sensor-icon">
                    <i class="fas fa-thermometer-half"></i>
                </div>
                <div class="sensor-title">ì˜¨ë„</div>
            </div>
            <div class="sensor-value">
                <span id="temperature-value" class="loading">--</span>
                <span class="sensor-unit">Â°C</span>
            </div>
            <div class="sensor-info" id="temperature-info">BME688 ì„¼ì„œ</div>
        </div>

        <!-- ìŠµë„ ì„¼ì„œ -->
        <div class="sensor-card humidity">
            <div class="sensor-header">
                <div class="sensor-icon">
                    <i class="fas fa-tint"></i>
                </div>
                <div class="sensor-title">ìŠµë„</div>
            </div>
            <div class="sensor-value">
                <span id="humidity-value" class="loading">--</span>
                <span class="sensor-unit">%</span>
            </div>
            <div class="sensor-info" id="humidity-info">BME688 ì„¼ì„œ</div>
        </div>

        <!-- ì¡°ë„ ì„¼ì„œ -->
        <div class="sensor-card light">
            <div class="sensor-header">
                <div class="sensor-icon">
                    <i class="fas fa-sun"></i>
                </div>
                <div class="sensor-title">ì¡°ë„</div>
            </div>
            <div class="sensor-value">
                <span id="light-value" class="loading">--</span>
                <span class="sensor-unit">lux</span>
            </div>
            <div class="sensor-info" id="light-info">BH1750 ì„¼ì„œ</div>
        </div>

        <!-- ì°¨ì•• ì„¼ì„œ -->
        <div class="sensor-card pressure">
            <div class="sensor-header">
                <div class="sensor-icon">
                    <i class="fas fa-compress-alt"></i>
                </div>
                <div class="sensor-title">ì°¨ì••</div>
            </div>
            <div class="sensor-value">
                <span id="pressure-value" class="loading">--</span>
                <span class="sensor-unit">Pa</span>
            </div>
            <div class="sensor-info" id="pressure-info">BME688 ê¸°ì¤€ ëŒ€ê¸°ì•• ë³€í™˜</div>
        </div>

        <!-- ì§„ë™ ì„¼ì„œ -->
        <div class="sensor-card vibration">
            <div class="sensor-header">
                <div class="sensor-icon">
                    <i class="fas fa-wave-square"></i>
                </div>
                <div class="sensor-title">ì§„ë™</div>
            </div>
            <div class="sensor-value">
                <span id="vibration-value" class="loading">--</span>
                <span class="sensor-unit">g</span>
            </div>
            <div class="sensor-info" id="vibration-info">ì‹œê°„ëŒ€ë³„ ê°€ìƒ ì„¼ì„œ</div>
        </div>

        <!-- ê³µê¸°ì§ˆ ì„¼ì„œ -->
        <div class="sensor-card air-quality">
            <div class="sensor-header">
                <div class="sensor-icon">
                    <i class="fas fa-leaf"></i>
                </div>
                <div class="sensor-title">ê³µê¸°ì§ˆ</div>
            </div>
            <div class="sensor-value">
                <span id="air-quality-value" class="loading">--</span>
                <span class="sensor-unit">/100</span>
            </div>
            <div class="sensor-info" id="air-quality-info">BME688 ê°€ìŠ¤ ì €í•­ ê¸°ë°˜</div>
        </div>
    </div>

    <div class="footer">
        <p>ğŸš€ EZ-Dash ì‹¤ì‹œê°„ ì„¼ì„œ ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ</p>
        <p>ë¼ì¦ˆë² ë¦¬íŒŒì´ 4 + BME688 + BH1750</p>
    </div>

    <script>
        const API_BASE = window.location.origin + '/api';
        
        let updateInterval;
        let isUpdating = false;

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            console.log('EZ-Dash ì‹¬í”Œ ëŒ€ì‹œë³´ë“œ ì‹œì‘');
            
            // ì´ˆê¸° ë°ì´í„° ë¡œë“œ
            updateSensorData();
            
            // 3ì´ˆë§ˆë‹¤ ìë™ ì—…ë°ì´íŠ¸
            updateInterval = setInterval(updateSensorData, 3000);
            
            // í˜ì´ì§€ ì–¸ë¡œë“œ ì‹œ ì •ë¦¬
            window.addEventListener('beforeunload', function() {
                if (updateInterval) {
                    clearInterval(updateInterval);
                }
            });
        });

        // ì„¼ì„œ ë°ì´í„° ì—…ë°ì´íŠ¸
        async function updateSensorData() {
            if (isUpdating) return;
            isUpdating = true;
            
            try {
                // ì—…ë°ì´íŠ¸ ì¤‘ í‘œì‹œ
                document.querySelectorAll('.sensor-card').forEach(card => {
                    card.classList.add('updating');
                });
                
                // í˜„ì¬ ì„¼ì„œ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
                const response = await fetch(`${API_BASE}/current`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                // ì„¼ì„œ ìƒíƒœ ê°€ì ¸ì˜¤ê¸°
                const statusResponse = await fetch(`${API_BASE}/status`);
                const statusData = await statusResponse.json();
                
                // UI ì—…ë°ì´íŠ¸
                updateSensorDisplay(data);
                updateStatus(statusData, data.timestamp);
                
                console.log('ì„¼ì„œ ë°ì´í„° ì—…ë°ì´íŠ¸ ì™„ë£Œ:', data);
                
            } catch (error) {
                console.error('ì„¼ì„œ ë°ì´í„° ì—…ë°ì´íŠ¸ ì˜¤ë¥˜:', error);
                updateStatus({ connected: false, error: error.message });
                
                // ì—ëŸ¬ ì‹œ ê°’ë“¤ì„ ì—ëŸ¬ ìƒíƒœë¡œ í‘œì‹œ
                const sensors = ['temperature', 'humidity', 'light', 'pressure', 'vibration', 'air-quality'];
                sensors.forEach(sensor => {
                    const element = document.getElementById(`${sensor}-value`);
                    if (element) {
                        element.textContent = 'ì˜¤ë¥˜';
                        element.className = 'error';
                    }
                });
            } finally {
                // ì—…ë°ì´íŠ¸ ì¤‘ í‘œì‹œ ì œê±°
                document.querySelectorAll('.sensor-card').forEach(card => {
                    card.classList.remove('updating');
                });
                isUpdating = false;
            }
        }

        // ì„¼ì„œ í‘œì‹œ ì—…ë°ì´íŠ¸
        function updateSensorDisplay(data) {
            // ì˜¨ë„
            updateSensorValue('temperature', data.temperature, 1);
            
            // ìŠµë„
            updateSensorValue('humidity', data.humidity, 1);
            
            // ì¡°ë„
            updateSensorValue('light', data.light, 0);
            
            // ì°¨ì••
            updateSensorValue('pressure', data.pressure, 1);
            
            // ì§„ë™
            updateSensorValue('vibration', data.vibration, 2);
            
            // ê³µê¸°ì§ˆ
            updateSensorValue('air-quality', data.air_quality, 0);
            
            // ì¶”ê°€ ì •ë³´ ì—…ë°ì´íŠ¸
            document.getElementById('temperature-info').textContent = 
                `BME688 ì„¼ì„œ (ì ˆëŒ€ì••ë ¥: ${data.absolute_pressure.toFixed(1)} hPa)`;
            document.getElementById('air-quality-info').textContent = 
                `ê°€ìŠ¤ì €í•­: ${data.gas_resistance.toFixed(0)} Î©`;
        }

        // ê°œë³„ ì„¼ì„œ ê°’ ì—…ë°ì´íŠ¸
        function updateSensorValue(sensorId, value, decimals) {
            const element = document.getElementById(`${sensorId}-value`);
            if (element) {
                if (typeof value === 'number') {
                    element.textContent = value.toFixed(decimals);
                    element.className = '';
                } else {
                    element.textContent = '--';
                    element.className = 'loading';
                }
            }
        }

        // ìƒíƒœ ì—…ë°ì´íŠ¸
        function updateStatus(statusData, timestamp) {
            const statusIcon = document.getElementById('status-icon');
            const statusText = document.getElementById('status-text');
            const lastUpdate = document.getElementById('last-update');
            
            if (statusData.connected) {
                statusIcon.style.color = '#4caf50';
                statusText.textContent = `ì„¼ì„œ ì—°ê²°ë¨ (${statusData.total_sensors}/2)`;
                
                if (timestamp) {
                    const time = new Date(timestamp).toLocaleTimeString();
                    lastUpdate.textContent = ` | ì—…ë°ì´íŠ¸: ${time}`;
                }
            } else {
                statusIcon.style.color = '#f44336';
                statusText.textContent = statusData.error ? `ì˜¤ë¥˜: ${statusData.error}` : 'ì„¼ì„œ ì—°ê²° ì•ˆë¨';
                lastUpdate.textContent = '';
            }
        }

        // ì—ëŸ¬ ì²˜ë¦¬ í•¨ìˆ˜
        function showError(message) {
            const grid = document.getElementById('sensors-grid');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error';
            errorDiv.innerHTML = `<i class="fas fa-exclamation-triangle"></i> ${message}`;
            grid.insertBefore(errorDiv, grid.firstChild);
            
            // 5ì´ˆ í›„ ì—ëŸ¬ ë©”ì‹œì§€ ì œê±°
            setTimeout(() => {
                if (errorDiv.parentNode) {
                    errorDiv.parentNode.removeChild(errorDiv);
                }
            }, 5000);
        }
    </script>
</body>
</html>